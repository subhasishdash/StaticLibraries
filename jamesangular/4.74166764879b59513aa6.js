(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"+xM8":function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var s=function(){function t(t){if(this.activeModal=t,this.radiologists=[],this.selectedRadiologists=[],this.multiple=!1,this.radiologists=JSON.parse(localStorage.getItem("radiologists")||"[]"),this.assignees=localStorage.assignees,"false"!==this.assignees)for(var e=this.assignees.split("|"),i=0;i<e.length;i++)this.selectedRadiologists.push(e[i])}return t.prototype.ngOnInit=function(){},t.prototype.dismiss=function(){this.activeModal.close("closing")},t.prototype.assign=function(){this.activeModal.close(this.selectedRadiologists.join("|"))},t.prototype.addRadiologist=function(){-1===this.selectedRadiologists.indexOf(this.radiologist)&&this.selectedRadiologists.push(this.radiologist)},t.prototype.removeRadiologist=function(t){var e=this.selectedRadiologists.indexOf(t);-1!==t&&this.selectedRadiologists.splice(e,1)},t}()},"1oJr":function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i("gq3f"),i("lGQG"),i("VGsI"),i("Zz1N");var s=function(){function t(t,e,i,s,o){this.activeModal=t,this.insService=e,this.authService=i,this.utility=s,this.studiesService=o,this.currentTask="",this.currentBtn="",this.modalitySettings={},this.institutionSettings={},this.userSettings={},this.modalitySettings={singleSelection:!1,idField:"k",textField:"v",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:5,allowSearchFilter:!0},this.institutionSettings={singleSelection:!1,idField:"institutionName",textField:"institutionName",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:3,allowSearchFilter:!0},this.userSettings={singleSelection:!1,idField:"key",textField:"value",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:3,allowSearchFilter:!0}}return t.prototype.ngOnInit=function(){},t.prototype.dismiss=function(){this.activeModal.close(null)},t.prototype.handleInstitutions=function(){var t=this.utility.searchComponent.institutions;if(this.utility.checkMultiSelectData(t)){var e=[];t.forEach((function(t){e.push(t.institutionName)})),this.utility.patientSearch.institutionNames=e.join(",")}else this.utility.patientSearch.institutionNames=void 0},t.prototype.handleAssignedUsers=function(){var t=this.utility.searchComponent.assignedUsers;if(this.utility.checkMultiSelectData(t)){var e=[];t.forEach((function(t){e.push(t.key)})),this.utility.patientSearch.assignedTo=e.join("|")}else this.utility.patientSearch.assignedTo=void 0},t.prototype.handleModalities=function(){var t=this.utility.searchComponent.modality;if(this.utility.checkMultiSelectData(t)){var e=[];t.forEach((function(t){e.push(t.k)})),this.utility.patientSearch.modalities=e.join(",")}else this.utility.patientSearch.modalities=void 0},t.prototype.handleStudyStatus=function(){var t=[],e=this.utility.studyStatus;for(var i in e)e[i].selection&&t.push(e[i].value);this.utility.patientSearch.currentStatus=void 0,t.length>0&&(this.utility.patientSearch.currentStatus=t.join("|"))},t.prototype.searchStudies=function(){this.handleModalities(),this.handleStudyStatus(),this.handleAssignedUsers(),this.handleInstitutions(),""===this.utility.patientSearch.assignedTo&&(this.utility.patientSearch.assignedTo=void 0);var t=this.utility.patientSearch.institutionNames,e=this.utility.patientSearch.assignedTo;"object"==typeof t&&(this.utility.patientSearch.institutionNames=t.join(",")),"object"==typeof e&&(this.utility.patientSearch.assignedTo=e.join("|")),this.activeModal.close([])},t.prototype.onItemSelect=function(t){console.log(t)},t.prototype.onSelectAll=function(t){console.log(t)},t}()},"3OP7":function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i("lGQG"),i("VGsI");var s=function(){function t(t,e,i){this.activeModal=t,this.authService=e,this.utility=i,this.authService.stompClient.connected&&this.authService.stompClient.send("/app/loadSCPSettings",{})}return t.prototype.ngOnInit=function(){},t.prototype.dismiss=function(){this.activeModal.close(null)},t.prototype.save=function(){this.activeModal.close(this.authService.iodSettings)},t}()},"62q8":function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i("VGsI"),i("lGQG"),i("ppW+"),i("cpn4");var s=function(){function t(t,e,i,s,o,n){this.activeModal=t,this.utility=e,this.authService=i,this.repService=s,this.sanitize=o,this.fileService=n,this.webReportHeight=.95*window.innerHeight,this.filteredTemplates=[],this.htmlContent="",this.reports={},this.users=[],this.reportEditMode=!1,this.isLocked=!1,this.config={editable:!0,spellcheck:!0,height:"15rem",minHeight:"5rem",placeholder:"Enter text here...",translate:"no",defaultParagraphSeparator:"p",defaultFontName:"Arial",customClasses:[{name:"quote",class:"quote"},{name:"redText",class:"redText"},{name:"titleText",class:"titleText",tag:"h1"}]},this.study=JSON.parse(localStorage.getItem("currentStudy")||"{}"),this.study.patientID&&(this.repService.studyDateTime=this.study.studyDateTime,this.repService.patientName=this.study.patientName,this.reports=this.repService.resetReportDefaults(this.study,"Draft"),this.selectedModality=this.study.modalities,this.openReport(JSON.parse(localStorage.getItem("currentReport")||"{}")),this.repService.reportLocked&&(this.config.editable=!1))}return t.prototype.attachSign=function(){this.htmlContent+='<img width="150" height="150" src="'+this.authService.profileSign.changingThisBreaksApplicationSecurity+'"/>'},t.prototype.exportAsDoc=function(){this.repService.downloadAsDoc(this.study,this.htmlContent,this.reports.modalityStudyDescription)},t.prototype.printReport=function(){var t=window.open("","Print Preview","menubar=1");t.document.write(this.repService.getWebReportForExport(this.study,this.htmlContent)),t.document.close(),t.focus(),t.print(),t.close()},t.prototype.openReport=function(t){t.reportStatus&&(this.reportEditMode=!0,this.reports.reportStatus=t.reportStatus,this.reports.reportResult=t.reportResult,this.reports.modalityStudyDescription=t.modalityStudyDescription,this.reports.studyId=t.id,this.htmlContent=atob(t.reportContent),this.isLocked="Locked"===t.reportStatus)},t.prototype.ngOnInit=function(){},t.prototype.dismiss=function(t){this.activeModal.close(t)},t.prototype.saveReport=function(t){var e=this,i=this.htmlContent,s=htmlDocx.asBlob(i);this.fileService.imageFile=this.utility.blobToFile(s,this.repService.prepareWebReportName(this.study,this.reports.modalityStudyDescription));var o=btoa(this.htmlContent);this.repService.saveReport(t,o,"Web Report",(function(){e.dismiss(o),e.utility.reportListModal.close()}),btoa(i))},t.prototype.openTemplate=function(t){for(var e=0;e<this.repService.templates.length;e++){var i=this.repService.templates[e];if(i.name===t){this.htmlContent=atob(i.content),this.activeTemplate=i.name;break}}},t.prototype.isTemplateAssigned=function(t){if(t.assignee)for(var e=t.assignee.split(","),i=0;i<e.length;i++)if(e[i]===this.authService.username)return!0;return!1},t.prototype.setTemplates=function(){if(this.filteredTemplates=[],this.reports.modalityStudyDescription)for(var t=this.reports.modalityStudyDescription.split(" ")[0].toUpperCase(),e=0;e<this.repService.templates.length;e++){var i=this.repService.templates[e];-1===i.name.indexOf(t)||i.modality!==this.study.modalities||!this.isTemplateAssigned(i)&&1!==this.authService.currentRole||this.filteredTemplates.push(i)}},t}()},ByiH:function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i("N+K7"),i("VGsI"),i("cpn4"),i("lGQG"),i("kyOO");var s=function(){function t(t,e,i,s,o,n){var r=this;this.activeModal=t,this.utility=e,this.fileService=i,this.authService=s,this.httpService=o,this.langService=n,this.langData=[],this.currentColumnData={},this.currentColumnData=JSON.parse(localStorage.getItem("editLang"));var a=localStorage.getItem("AllLanguages");this.langData=JSON.parse(a),this.langData.forEach((function(t){"input"!==t.key&&(t.newVal=r.currentColumnData[t.key])}))}return t.prototype.ngOnInit=function(){},t.prototype.dismiss=function(){this.activeModal.close("closing")},t.prototype.updateKey=function(){var t=this,e={input:this.currentColumnData.input},i=this.langData;i.forEach((function(i){i.value=t.langService.b64EncodeUnicode(i.newVal),e[i.key]=i.value}));var s=this;this.httpService.postData(this.utility.getIP()+"/language/changeVal",e,(function(e){t.utility.gridApi.forEachNode((function(t){t.data.input===e.input&&i.forEach((function(i){t.data[i.key]=s.langService.b64DecodeUnicode(i.value),t.setDataValue("input",e.input)}))})),t.dismiss()}))},t}()},Goax:function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i("N+K7"),i("VGsI"),i("cpn4"),i("lGQG"),i("kyOO");var s=function(){function t(t,e,i,s,o,n){this.activeModal=t,this.utility=e,this.fileService=i,this.authService=s,this.httpService=o,this.langService=n,this.newKey=""}return t.prototype.ngOnInit=function(){},t.prototype.addKey=function(){var t=this,e=this.langService.langData;this.langService.langData=[],this.httpService.postData(this.utility.getIP()+"/language/addKey?input="+this.langService.b64EncodeUnicode(this.newKey),{},(function(i){for(var s in i)"input"!==s&&(i[s]=t.langService.b64DecodeUnicode(i[s]));e.push(i),t.langService.langData=e,console.log(t.langService.langData),t.utility.gridApi.applyTransaction({add:t.langService.langData}),t.utility.sizeToFit(),t.dismiss()}))},t.prototype.dismiss=function(){this.activeModal.close("closing")},t}()},GufE:function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i("Zz1N"),i("VGsI");var s=function(){function t(t,e,i){if(this.activeModal=t,this.studiesService=e,this.utility=i,this.radiologist=[],this.radiologists=[],this.selectedRadiologists=[],this.multiple=!1,this.assignSettings={},this.radiologists=JSON.parse(localStorage.getItem("radiologists")||"[]"),console.log("filtered users - "),localStorage.getItem("filteredUsers")&&(this.radiologists=JSON.parse(localStorage.getItem("filteredUsers")||"[]"),localStorage.removeItem("filteredUsers")),this.studiesService.fillForMultiSelect(this.radiologists,!0),this.isUnassigning=localStorage.isUnassigning,"false"!==this.isUnassigning){var s=this.isUnassigning.split("|");this.setAssignedRadiologists(s,this.radiologists),0===this.radiologist.length&&this.setAssignedRadiologists(s,JSON.parse(localStorage.getItem("radiologists")||"[]"))}this.assignSettings={singleSelection:!1,idField:"key",textField:"value",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:3,allowSearchFilter:!0}}return t.prototype.setAssignedRadiologists=function(t,e){for(var i=0;i<e.length;i++){var s=e[i],o=s.key,n=s.value;-1!==t.indexOf(o)&&this.radiologist.push({key:o,value:n})}},t.prototype.ngOnInit=function(){},t.prototype.dismiss=function(){this.activeModal.close("closing")},t.prototype.assign=function(){var t=this.radiologist;if(console.log(t),this.utility.checkMultiSelectData(t)){var e=[];t.forEach((function(t){e.push(t.key)})),this.selectedRadiologists=e}else this.utility.patientSearch.modalities=void 0;this.activeModal.close(this.selectedRadiologists.join("|"))},t.prototype.addRadiologist=function(){-1===this.selectedRadiologists.indexOf(this.radiologist)&&this.selectedRadiologists.push(this.radiologist)},t.prototype.removeRadiologist=function(t){var e=this.selectedRadiologists.indexOf(t);-1!==t&&this.selectedRadiologists.splice(e,1)},t}()},Tpmm:function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i("VGsI"),i("cpn4"),i("lGQG");var s=function(){function t(t,e,i,s){this.activeModal=t,this.utility=e,this.fileService=i,this.authService=s,this.moreStudy={},this.moreStudy=JSON.parse(localStorage.getItem("currentStudy")||"{}"),this.moreStudy.assignedTo&&(this.moreStudy.assignedTo=this.moreStudy.assignedTo.split("|"))}return t.prototype.ngOnInit=function(){},t.prototype.dismiss=function(){this.activeModal.close()},t}()},U7Co:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var s=i("nnC/"),o=i("N+K7"),n=i("VGsI"),r=i("8Y7J"),a=function(){function t(t,e){this.utility=t,this.httpService=e,this.tableData={language:{columnDefs:[{headerName:"Key",field:"input",checkboxSelection:!0,headerCheckboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,tooltipField:"input",flex:1},{headerName:"English",field:"english",tooltipField:"english",flex:2},{headerName:"Hindi",field:"hindi",tooltipField:"hindi",flex:3},{headerName:"Spanish",field:"spanish",tooltipField:"spanish",flex:4},{headerName:"Actions",field:"actions",cellRendererFramework:s.a,pinned:"right",lockPinned:!0}]}}}return t.\u0275prov=r.Yb({factory:function(){return new t(r.Zb(n.a),r.Zb(o.a))},token:t,providedIn:"root"}),t}()},V2xp:function(t,e,i){"use strict";i.d(e,"a",(function(){return n})),i("N+K7"),i("VGsI"),i("cpn4"),i("lGQG");var s=i("PSD3"),o=i.n(s),n=(i("qKms"),function(){function t(t,e,i,s,o,n,r){this.activeModal=t,this.httpService=e,this.utility=i,this.attr=s,this.fileService=o,this.authService=n,this.zone=r,this.history={},this.seriesCountInfo={numOfImages:0,numOfSeries:0};var a=JSON.parse(localStorage.getItem("currentStudy")||"{}");a.patientID&&(this.studyDateTime=a.studyDateTime,this.patientName=a.patientName,this.showHistory(a))}return t.prototype.ngOnInit=function(){},t.prototype.dismiss=function(){this.activeModal.close()},t.prototype.showHistory=function(t){var e=this,i=t.patientID,s=t.patientName,o=t.gender,n=t.dateOfBirth,r=t.studyInstanceUID,a=t.institutionName,l=t.modalities,c=t.studySeriesCount;this.httpService.postData(this.utility.getIP()+"/history/getClinicalHistory",{patientID:i,patientName:s,studyInstanceUID:r,institutionName:a},(function(t){var p="..."===c?[0,0]:c.split("/");e.seriesCountInfo={numOfSeries:p[1],numOfImages:p[0]},200===t.status&&t.result?(t=t.result,console.log(t),e.history={id:t.id,clinicalHistory:t.clinicalHistory,reportRequiredType:t.reportRequiredType,modality:l,modalityStudyDescription:t.modalityStudyDescription,docName:t.docName,patientID:i,patientName:s,gender:o,dateOfBirth:n,studyInstanceUID:r,institutionName:a},console.log(e.history)):e.history={id:-1,patientID:i,patientName:s,gender:o,modality:l,dateOfBirth:n,studyInstanceUID:r,institutionName:a},e.zone.run((function(t){console.log("UI Updated")}))}))},t.prototype.saveClinicalHistory=function(){var t=this;if(this.history.modalityStudyDescription&&this.history.reportRequiredType&&this.history.clinicalHistory){var e=new FormData;e.append("seriesCountInfo",JSON.stringify(this.seriesCountInfo)),e.append("jsonData",JSON.stringify(this.history)),e.append("studyDateTime",this.studyDateTime),e.append("patientName",this.patientName),this.fileService.imageFile&&e.append("document",this.fileService.imageFile,this.fileService.imageFile.name),this.httpService.postData(this.utility.getIP()+"/history/saveClinicalHistory",e,(function(e){200===e.status?(t.activeModal.close(),t.utility.updateImageCount(t.history.studyInstanceUID,t.seriesCountInfo.numOfImages+"/"+t.seriesCountInfo.numOfSeries,!t.attr.grid)):o.a.fire("Failure","Unable to Save Clinical History : "+e.message,"error")}))}else o.a.fire("Failure","All fields are mandatory","error")},t.prototype.isRestrictedToEdit=function(){return!this.authService.isCenterOwner&&(3===this.authService.currentRole||4===this.authService.currentRole||5===this.authService.currentRole)},t}())},VQPA:function(t,e,i){"use strict";i.d(e,"a",(function(){return R}));var s=i("Zz1N"),o=i("lGQG"),n=i("dBhf"),r=i("Tpmm"),a=i("1oJr"),l=i("V2xp"),c=i("GufE"),p=i("nYZq"),u=i("+xM8"),h=i("Goax"),d=i("a4sI"),g=i("lvq5"),f=i("VGsI"),y=i("PSD3"),m=i.n(y),S=i("qfBg"),v=i("qKms"),I=i("3OP7"),D=i("8Y7J"),R=function(){function t(t,e,i,s,o,n){this.studiesService=t,this.attr=e,this.templateService=i,this.userService=s,this.authService=o,this.utility=n}return t.prototype.showMore=function(t,e){localStorage.setItem("currentStudy",JSON.stringify(t)),e.open(r.a,{size:"lg",centered:!0}).result.then((function(t){}),(function(t){}))},t.prototype.search=function(t){var e=this,i=t.open(a.a,{size:"lg",centered:!0});i.componentInstance.currentTask="Search Studies",i.componentInstance.currentBtn="search",i.result.then((function(t){t&&e.studiesService.searchStudiesFromPacs()}),(function(t){}))},t.prototype.addFilterName=function(t,e){var i=this;m.a.fire({title:"Enter Filter name",input:"text",inputAttributes:{autocapitalize:"off"},showLoaderOnConfirm:!0,showCancelButton:!0,confirmButtonText:"Add Filter",allowOutsideClick:function(){return!m.a.isLoading()}}).then((function(s){if(s.isConfirmed){var o=s.value;""===o?m.a.fire("Failure","Filter name cannot be empty","error").then((function(){return i.addFilterName(t,e)})):-1===t.indexOf(o)?e(o):m.a.fire("Failure","Filter already exists with filter name => "+o,"error").then((function(){return i.addFilterName(t,e)}))}}))},t.prototype.openFilterForSearch=function(t){var e=this,i=t.open(a.a,{size:"lg",centered:!0});i.componentInstance.currentTask="Add Filter",i.componentInstance.currentBtn="plus",i.result.then((function(t){if(t){console.log("Submitted");var i=localStorage.getItem("userCustomFilters"),s=[],o=[];i&&(o=JSON.parse(i)).forEach((function(t){s.push(t.filterName)})),e.addFilterName(s,(function(t){o.push({filterName:t,filterData:e.utility.patientSearch}),localStorage.setItem("userCustomFilters",JSON.stringify(o)),e.userService.saveUserSettings()}))}}),(function(t){}))},t.prototype.clinicalHistory=function(t,e){localStorage.setItem("currentStudy",JSON.stringify(t)),e.open(l.a,{size:"lg",centered:!0})},t.prototype.assign=function(t,e,i,s){var o=this;void 0===t&&(t=!1),localStorage.isUnassigning=s;var n=i.open(c.a,{size:"lg",centered:!0});t&&(n.componentInstance.multiple=!0),n.result.then((function(t){localStorage.isUnassigning=!1,"closing"!==t&&(t?(o.studiesService.radiologist=t,o.attr.grid||o.studiesService.fillSelectedRows(),e?o.studiesService.assignStudy("Assigned",!1,e.studyInstanceUID,e):o.studiesService.assignStudy("Assigned",!1,null,null)):o.studiesService.updateStatus(e,!0,e.patientID))}),(function(t){}))},t.prototype.onDelete=function(t,e){var i=this;e.open(t,{centered:!0}).result.then((function(){i.studiesService.deleteStudy()}),(function(){console.log("Backdrop click")}))},t.prototype.openReportsPage=function(t,e){localStorage.setItem("currentStudy",JSON.stringify(t)),e.open(p.a,{size:"lg",centered:!0}).result.then((function(t){console.log(t)}),(function(t){}))},t.prototype.assignTemplate=function(t,e){var i=this;localStorage.assignees=e,t.open(u.a,{centered:!0}).result.then((function(t){localStorage.assignees=!1,"closing"!==t&&t&&(console.log(t),i.templateService.updateTemplates(t,0))}),(function(t){}))},t.prototype.addLanguageKey=function(t){t.open(h.a,{size:"lg",centered:!0})},t.prototype.changeLanguage=function(t){t.open(d.a,{size:"lg",centered:!0})},t.prototype.changePassword=function(t){t.open(g.a,{size:"lg",centered:!0}).result.then((function(t){}),(function(t){}))},t.prototype.iod=function(t){var e=this;t.open(I.a,{size:"lg",centered:!0}).result.then((function(t){t&&e.authService.stompClient.send("/app/saveSCP",{},JSON.stringify(t))}),(function(t){}))},t.\u0275prov=D.Yb({factory:function(){return new t(D.Zb(s.a),D.Zb(v.a),D.Zb(n.a),D.Zb(S.a),D.Zb(o.a),D.Zb(f.a))},token:t,providedIn:"root"}),t}()},a4sI:function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i("VGsI"),i("cpn4"),i("lGQG"),i("U7Co");var s=function(){function t(t,e,i,s,o){this.activeModal=t,this.utility=e,this.fileService=i,this.authService=s,this.agGridTableService=o,this.langData=[],this.langSettings={},this.langSettings={singleSelection:!1,idField:"key",textField:"value",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:5,allowSearchFilter:!0};var n=localStorage.getItem("AllLanguages");this.langData=JSON.parse(n),console.log(this.langData)}return t.prototype.ngOnInit=function(){},t.prototype.dismiss=function(){this.activeModal.close("closing")},t.prototype.updateLanguages=function(){var t=this;console.log(this.selectedLang);var e=this.agGridTableService.tableData.language.columnDefs.length-1;this.selectedLang.forEach((function(i){for(var s=e,o=t.agGridTableService.tableData.language.columnDefs,n=!1,r=0;r<o.length;r++)if(o[r].headerName===i.value){n=!0;break}n||(t.agGridTableService.tableData.language.columnDefs.splice(s,0,{headerName:i.value,field:i.key,tooltipField:i.key,flex:s+1}),e++)})),e=1,this.agGridTableService.tableData.language.columnDefs.forEach((function(t){return t.flex=e++})),this.utility.gridApi.setColumnDefs(this.agGridTableService.tableData.language.columnDefs),this.dismiss()},t}()},azxw:function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i("ppW+"),i("VGsI"),i("lGQG"),i("cpn4");var s=function(){function t(t,e,i,s,o,n){this.activeModal=t,this.utility=e,this.authService=i,this.repService=s,this.fileService=o,this.sanitize=n,this.fileReportHeight=.95*window.innerHeight,o.imageFile=null,this.study=JSON.parse(localStorage.getItem("currentStudy")||"{}"),this.study.patientID&&(this.repService.studyDateTime=this.study.studyDateTime,this.repService.patientName=this.study.patientName,this.reports=this.repService.resetReportDefaults(this.study,"Draft"),this.openReport(JSON.parse(localStorage.getItem("currentReport")||"{}")))}return t.prototype.ngOnInit=function(){},t.prototype.dismiss=function(){this.activeModal.close()},t.prototype.loadDocViewer=function(){var t="https://docs.google.com/gview?url="+this.utility.getIP()+"/pacs/getReportAttachment/"+this.reports.studyId+"/"+this.repService.patient.patientID.replace(/\//g,"~")+"/"+this.repService.patient.studyInstanceUID+"/"+this.repService.patient.patientName+"/"+this.repService.patient.studyDateTime+"&embedded=true";this.docURL=this.sanitize.bypassSecurityTrustResourceUrl(t)},t.prototype.openReport=function(t){var e=this;t.reportStatus&&(this.reportEditMode=!0,this.reports.reportStatus=t.reportStatus,this.reports.reportResult=t.reportResult,this.reports.modalityStudyDescription=t.modalityStudyDescription,this.reports.studyId=t.id,this.isLocked="Locked"===t.reportStatus,this.loadDocViewer(),setTimeout((function(){$("#fileReportModal").length>0&&e.loadDocViewer()}),4e3))},t.prototype.saveReport=function(t){var e=this;this.repService.saveReport(t,"PFA","File Report",(function(){e.dismiss(),e.utility.reportListModal.close()}))},t.prototype.allowFileDownload=function(){return 2===this.authService.currentRole?this.reportEditMode&&this.isLocked:this.reportEditMode},t}()},dBhf:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var s=i("VGsI"),o=i("N+K7"),n=i("lGQG"),r=i("8Y7J"),a=function(){function t(t,e,i,s){this.httpService=t,this.zone=e,this.authService=i,this.utility=s,this.isUpdating=!1,this.htmlContent="",this.editingTemplate=!1,this.templateName="",this.template={},console.log("File Service")}return t.prototype.editTemplate=function(t){var e=this;this.utility.loader=!0,this.httpService.fetchData(this.utility.getIP()+"/templates/getTemplateContent?id="+t.id,(function(t){e.utility.loader=!1,e.htmlContent=atob(t.content),e.zone.run((function(t){console.log(t)}))})),this.templateName=t.name,this.modality=t.modality,this.assignee=t.assignee,this.editingTemplate=!0,this.isUpdating=!0,this.template=t},t.prototype.toggleTemplate=function(t){this.editingTemplate=t,this.isUpdating=!1,this.modality=null,this.assignee=null,this.templateName=null,this.htmlContent=null},t.prototype.checkDuplicateTemplate=function(t){return!1},t.prototype.saveTemplate=function(){var t=this;if(""!==this.htmlContent)if(this.modality){var e=this.templateName;null!==e&&""!==e?this.checkDuplicateTemplate(e)?this.utility.flashMessage(this,"Template name already exists, Please try a different name",2e3):(console.log("Saving...",e),this.templateName=e,this.httpService.postData(this.utility.getIP()+"/templates/saveTemplate",{payload1:{name:this.templateName,modality:this.modality,assignee:this.assignee},payload2:{content:btoa(this.htmlContent)}},(function(e){t.utility.flashMessage(t,"Saved the template successfully.",500),t.loadTemplates(),t.templateName="",t.htmlContent="",t.toggleTemplate(!1)}))):this.utility.flashMessage(this,"Template name cannot be empty.",2e3)}else this.utility.flashMessage(this,"Please select modality",2e3);else this.utility.flashMessage(this,"Cannot save empty template",2e3)},t.prototype.onGridReady=function(t){this.utility.gridApi=t.api,this.loadTemplates()},t.prototype.loadTemplates=function(){var t=this;this.utility.loader=!0;var e=this.utility.getIP();this.rowData=this.httpService.fetchData(e+"/templates/getAllTemplates",(function(){t.utility.sizeToFit()}),!1)},t.prototype.updateRow=function(t,e,i){this.utility.gridApi.forEachNode((function(s){s.data.id===t&&(s.data.modality=e,s.data.assignee=i,s.setDataValue("modality",e),s.setDataValue("assignee",i))}))},t.prototype.updateTemplates=function(t,e){var i=this;this.utility.loader=!0,e=e||0;var s=this.utility.gridApi.getSelectedRows()[e];if(!s)return this.utility.loader=!1,void this.utility.flashMessage(this,"updated successfully",500);s.assignee=t.split("|").join(","),this.templateName=s.name,this.modality=s.modality,this.assignee=s.assignee,this.template=s,this.updateTemplate((function(){i.updateTemplates(t,e+1)}))},t.prototype.updateTemplate=function(t){var e=this;this.template.modality=this.modality,this.template.assignee=this.assignee,this.httpService.postData(this.utility.getIP()+"/templates/updateTemplate",{payload1:this.template,payload2:t?null:{content:btoa(this.htmlContent)}},(function(){var i=e.utility.gridApi.getSelectedRows();e.updateRow(i[0].id,e.modality,e.assignee),t?t():(e.toggleTemplate(!1),e.utility.flashMessage(e,"updated successfully",500))}))},t.prototype.deleteTemplate=function(t,e){var i=this,s=t.id;this.utility.loader=!0,this.httpService.postData(this.utility.getIP()+"/templates/deleteTemplate",{deletedId:s},(function(){e?e():i.loadTemplates(),i.utility.flashMessage(i,"Deleted Successfully",500)}))},t.prototype.deleteTemplates=function(t){var e=this,i=this.utility.gridApi.getSelectedRows()[t];this.utility.loader=!0,i?this.deleteTemplate(i,(function(){return e.deleteTemplates(t+1)})):this.loadTemplates()},t.\u0275prov=r.Yb({factory:function(){return new t(r.Zb(o.a),r.Zb(r.z),r.Zb(n.a),r.Zb(s.a))},token:t,providedIn:"root"}),t}()},lvq5:function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i("N+K7"),i("VGsI");var s=function(){function t(t,e,i){this.activeModal=t,this.httpService=e,this.utility=i,this.colors=["#F00","#F90","#FF0","#9F0","#0F0"],this.passwordMatchingStatus="",this.password="",this.cpassword="",this.barLabel="Password strength:",this.user=JSON.parse(localStorage.getItem("userData"))}return t.prototype.ngOnInit=function(){},t.prototype.dismiss=function(){this.activeModal.close()},t.prototype.measureStrength=function(t){for(var e=0,i={},s=0;s<t.length;s++)i[t[s]]=(i[t[s]]||0)+1,e+=5/i[t[s]];var o={digits:/\d/.test(t),lower:/[a-z]/.test(t),upper:/[A-Z]/.test(t),nonWords:/\W/.test(t)},n=0;for(var r in o)n+=o[r]?1:0;return e+=10*(n-1),Math.trunc(e)},t.prototype.getColor=function(t){var e=0;return t>90?e=4:t>70?e=3:t>=40?e=2:t>=20&&(e=1),{idx:e+1,col:this.colors[e]}},t.prototype.setBarColors=function(t,e){for(var i=0;i<t;i++)this["bar"+i]=e},t.prototype.checkStrength=function(){if(this.setBarColors(5,"#DDD"),this.password){var t=this.getColor(this.measureStrength(this.password));this.setBarColors(t.idx,t.col)}""!==this.password&&""!==this.cpassword||(this.passwordMatchingStatus="")},t.prototype.checkPassword=function(){this.passwordMatchingStatus="",this.password!==this.cpassword&&(this.passwordMatchingStatus="Passwords not matching")},t.prototype.changePassword=function(){var t=this;""===this.passwordMatchingStatus&&""!==this.password&&(this.user.password=this.password,this.httpService.postData(this.utility.getIP()+"/users/updateUser",this.user,(function(){t.dismiss()})))},t}()},nYZq:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var s=i("8Y7J"),o=i("62q8"),n=i("azxw"),r=(i("VGsI"),i("N+K7"),i("lGQG"),i("cpn4"),i("ppW+"),function(){function t(t,e,i,o,n,r,a){this.modalSer=t,this.activeModal=e,this.utility=i,this.httpService=o,this.authService=n,this.reportService=r,this.fileService=a,this.reports={},this.reportTab=1,this.reportIds=[],this.isLocked=!1,this.reportEditMode=!1,this.reportListHeight=.35*window.innerHeight,this.valChange=new s.n,this.study=JSON.parse(localStorage.getItem("currentStudy")||"{}"),this.listReports(this.study),this.utility.reportListModal=this.activeModal;var l=JSON.parse(localStorage.getItem("currentStudy")||"{}");l.patientID&&(this.reportService.studyDateTime=l.studyDateTime,this.reportService.patientName=l.patientName,this.reportService.patient=l),console.log(this.study)}return t.prototype.ngOnInit=function(){},t.prototype.resetReportDefaults=function(t){this.reports={studyInstanceUID:t.studyInstanceUID,patientName:t.patientName,patientID:t.patientID,gender:t.gender,modalityStudyDescription:"",reportStatus:"Locked",institutionName:t.institutionName}},t.prototype.updateStudy=function(){var t="Draft";this.reportService.allReports.forEach((function(e){"Locked"===e.reportStatus&&(t="Locked")}));var e=this.utility.gridApi.getSelectedRows();1===e.length&&this.utility.updateRow(e[0].id,t,null)},t.prototype.listReports=function(t){var e=this;this.reportService.getScanCenterEmail(t),this.reportTab=1,this.httpService.fetchData(this.utility.getIP()+"/reports/getAllReports?isCenterOwner="+this.authService.isCenterOwner+"&patientID="+t.patientID+"&studyInstanceUID="+t.studyInstanceUID+"&username="+this.authService.username+"&role="+this.authService.currentRole+"&institutionName="+t.institutionName,(function(t){e.reportService.allReports=t,e.updateStudy(),$(".modal-lg").css("max-width","80%")}))},t.prototype.showWebReport=function(){this.reportTab=2,this.child.htmlContent="",this.isLocked=!1,this.reports.studyInstanceUID&&this.resetReportDefaults(this.reports)},t.prototype.showFileReport=function(){this.reportEditMode=!1,this.reportTab=3,this.isLocked=!1,this.reports.studyInstanceUID&&this.resetReportDefaults(this.reports)},t.prototype.openReport=function(t){this.reportService.reportLocked="Locked"===t.reportStatus,localStorage.setItem("currentReport",JSON.stringify(t)),"Web Report"===t.reportType?this.modalSer.open(o.a,{size:"lg",centered:!0}).result.then((function(e){e&&(t.reportContent=e)}),(function(t){})):this.modalSer.open(n.a,{size:"lg",centered:!0}).result.then((function(t){}),(function(t){}))},t.prototype.downloadReport=function(t){if("Web Report"===t.reportType)this.reportService.downloadAsDoc(this.study,atob(t.reportContent),t.modalityStudyDescription);else{var e=document.createElement("a");e.href=this.utility.ipaddress+"/reports/getReportAttachment?id="+t.id+"&studyDateTime="+this.reportService.studyDateTime+"&patientName="+this.reportService.patientName,e.target="_blank",e.click()}},t.prototype.deleteReport=function(t,e){var i=this;this.httpService.postData(this.utility.getIP()+"/reports/deleteReport",{deletedId:t.id,studyId:this.study.id,patientID:this.study.patientID,patientName:this.study.patientName,radiologist:this.authService.getRadiologist(),currentStatus:this.utility.studyStates.InReporting,institution:this.study.institutionName,role:this.authService.currentRole,studyInstanceUID:this.study.studyInstanceUID,studyDateTime:this.reportService.studyDateTime},(function(t){console.log("Report Deleted"),i.reportService.allReports.splice(e,1),t.currentStatus===i.utility.studyStates.InReporting&&i.utility.updateRow(i.study.studyInstanceUID,i.utility.studyStates.InReporting,null)}))},t.prototype.onDelete=function(t,e,i){var s=this;this.modalSer.open(t,{centered:!0}).result.then((function(){console.log("When user closes"),e&&null!==i?s.deleteReport(e,i):(s.reportIds.forEach((function(t){for(var e=0;e<s.reportService.allReports.length;e++)if(s.reportService.allReports[e].id===t){s.deleteReport({id:t},e);break}})),s.reportIds=[])}),(function(){console.log("Backdrop click")}))},t.prototype.webReport=function(){var t=this;this.reportService.reportLocked=!1,localStorage.removeItem("currentReport"),this.modalSer.open(o.a,{size:"lg",centered:!0}).result.then((function(e){t.listReports(t.study)}),(function(t){}))},t.prototype.fileReport=function(){var t=this;this.reportService.reportLocked=!1,localStorage.removeItem("currentReport"),this.modalSer.open(n.a,{size:"lg",centered:!0}).result.then((function(e){t.listReports(t.study)}),(function(t){}))},t.prototype.listRepIds=function(t,e){var i=e.id,s=this.reportIds.indexOf(i);t.target.checked&&-1===s?(this.reportIds.push(i),e.checked=!0):t.target.checked||-1===s||(this.reportIds.splice(s,1),e.checked=!1),console.log(this.reportIds)},t.prototype.toggleSelection=function(t){var e=this;this.reportIds=[],this.reportService.allReports.forEach((function(i){var s=i;s.checked=t,i=s,t&&e.reportIds.push(s.id)})),this.selectAll=t},t.prototype.toggleSel=function(t){"select"===t?this.toggleSelection(!0):"clear"===t&&this.toggleSelection(!1)},t}())},"nnC/":function(t,e,i){"use strict";i.d(e,"a",(function(){return o})),i("VGsI"),i("N+K7"),i("kyOO");var s=i("ByiH"),o=function(){function t(t,e,i,s){this.modalSer=t,this.utility=e,this.httpService=i,this.langService=s}return t.prototype.agInit=function(t){this.params=t,this.data=t.value},t.prototype.ngOnInit=function(){},t.prototype.editUser=function(){localStorage.setItem("editLang",JSON.stringify(this.params.data)),this.modalSer.open(s.a,{size:"lg",centered:!0})},t.prototype.onDelete=function(t){var e=this;this.modalSer.open(t,{centered:!0}).result.then((function(){console.log("When user closes");for(var t=e.utility.gridApi.getSelectedRows(),i=function(i){for(var s=t[i].input,o=0,n=0;n<e.langService.langData.length;n++)s===e.langService.langData[n].input&&(o=n);e.httpService.postData(e.utility.getIP()+"/language/delKey?input="+s,{},(function(s){console.log(s),"SUCCESS"===s&&(e.utility.gridApi.applyTransaction({remove:[t[i]]}),e.langService.langData.splice(o,1))}))},s=0;s<t.length;s++)i(s)}),(function(){console.log("Backdrop click")}))},t}()},"ppW+":function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var s=i("lGQG"),o=i("cpn4"),n=i("N+K7"),r=i("VGsI"),a=i("Zz1N"),l=i("8Y7J"),c=function(){function t(t,e,i,s,o){this.authService=t,this.fileService=e,this.httpService=i,this.utility=s,this.studiesService=o,this.templates=[],this.allReports=[],this.patient={},this.reports={},this.templates=JSON.parse(localStorage.templates)}return t.prototype.getScanCenterEmail=function(t){var e=this;this.httpService.fetchData(this.utility.getIP()+"/instituteInfo/getScanCenterOwnerEmailId?insName="+t.institutionName,(function(t){e.scanCenterOwnerEmail=t}))},t.prototype.resetReportDefaults=function(t,e){return this.reports={id:t.id,studyInstanceUID:t.studyInstanceUID,patientName:t.patientName,patientID:t.patientID,gender:t.gender,modalityStudyDescription:"",reportStatus:e,institutionName:t.institutionName},this.reports},t.prototype.updateReportStats=function(t,e){t.currentStatus=e,this.studiesService.updateStatus(t,!1,!1)},t.prototype.updateList=function(){for(var t=0;t<this.allReports.length;t++)this.allReports[t].studyInstanceUID===this.reports.studyInstanceUID&&(this.allReports[t]=this.reports)},t.prototype.prepareReportData=function(){var t=JSON.parse(localStorage.getItem("currentStudy")||"{}");return{patientID:t.patientID,patientName:t.patientName,gender:t.gender,dateOfBirth:t.dateOfBirth,referringPhysician:t.referringPhysician,institutionName:t.institutionName,transmissionDate:t.transmissionDate,addHeaderInfo:this.authService.addHeaderInfo?"true":"false"}},t.prototype.saveReport=function(t,e,i,s,o){var n=this;if(this.reports.reportStatus="Locked",t&&(this.reports.reportStatus="Draft"),this.reports.reportContent=e,this.reports.reportType=i,this.reports.reportedDate=(new Date).toString(),this.reports.reportedBy=this.authService.username,this.reports.reportContent&&""!==this.reports.modalityStudyDescription&&this.reports.reportResult)if(this.fileService.imageFile){var r=new FormData;r.append("jsonData",JSON.stringify(this.reports)),r.append("reportData",JSON.stringify(this.prepareReportData())),r.append("document",this.fileService.imageFile,this.fileService.imageFile.name),r.append("ownerEmail",this.scanCenterOwnerEmail),r.append("reportType",i),r.append("reportContent",o),r.append("studyDateTime",this.studyDateTime),r.append("patientName",this.patientName),this.httpService.postData(this.utility.getIP()+"/reports/saveFileReport",r,(function(t){n.reports.id=t.id,n.updateReportStats(n.reports,"Draft"!==n.reports.reportStatus?"Reported":"Draft"),n.updateList(),s()}))}else alert("Please choose a report document and try again.");else alert("Please select all fields and try again.")},t.prototype.shouldDisabledReport=function(){return 2===this.authService.currentRole||this.reportLocked},t.prototype.addHeader=function(t){return"<span><strong>Date of Report</strong> : "+new Date+"</span><br>\n        <span><strong>Patient ID</strong> : "+t.patientID+"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n        <span><strong>Patient Name</strong> : "+t.patientName+"</span><br>\n        <span><strong>Date Of Birth</strong> : "+t.dateOfBirth+"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n        <span><strong>Referral Physician</strong> : "+t.referringPhysician+"</span><br><hr/>"},t.prototype.getWebReportForExport=function(t,e){return"<!DOCTYPE html>\n        <html>\n          <head></head>\n          <body> \n          "+this.addHeader(t)+" "+e+"\n          </body>\n        </html>"},t.prototype.prepareWebReportName=function(t,e){return t.patientID+"-"+t.modalities+"-"+e+".docx"},t.prototype.downloadAsDoc=function(t,e,i){var s=htmlDocx.asBlob(this.getWebReportForExport(t,e));saveAs(s,this.prepareWebReportName(t,i))},t.\u0275prov=l.Yb({factory:function(){return new t(l.Zb(s.a),l.Zb(o.a),l.Zb(n.a),l.Zb(r.a),l.Zb(a.a))},token:t,providedIn:"root"}),t}()}}]);